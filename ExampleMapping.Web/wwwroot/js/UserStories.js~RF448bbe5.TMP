function newRuleCollection() {
    var ruleWorkingClassName = "ruleWording";

    return {
        Count: function () {
            return document.getElementsByClassName(ruleWorkingClassName).length;
        },

        AddBlankRule: function () {
            var that = this;
            var newRuleIndex = this.Count();

            var newRuleElementsGroup = document.createElement("div");
            newRuleElementsGroup.ondragover = function (event) { event.preventDefault() };
            newRuleElementsGroup.ondrop = function (event) { that.DropBlankExample(event, newRuleElementsGroup); };

            var newRuleText = document.createElement("input");
            newRuleText.type = "text";
            newRuleText.className = ruleWorkingClassName;
            newRuleText.name = this.MakeRuleElementName(newRuleIndex, "Name");
            newRuleElementsGroup.appendChild(newRuleText);

            var newDeleteRuleButton = document.createElement("input");
            newDeleteRuleButton.type = "button";
            newDeleteRuleButton.className = "deleteRule";
            newDeleteRuleButton.value = "Delete";
            newDeleteRuleButton.onclick = function () { that.RemoveRuleDomElements(newRuleElementsGroup); };
            newRuleElementsGroup.appendChild(newDeleteRuleButton);

            var existingRulesContainer = document.getElementById("UserStoryContent");
            existingRulesContainer.appendChild(newRuleElementsGroup);

            newRuleText.focus();
        },

        MarkRuleAsDeleted: function(ruleElementsGroupId) {
            var ruleElementsGroup = document.getElementById(ruleElementsGroupId);
            var ruleIdElement = this.Single(ruleElementsGroup.children, function (element) { return element.id !== null && element.id === "RuleId"; });
            ruleIdElement.value = -ruleIdElement.value;
            ruleElementsGroup.style.display = "none";
        },

        DropBlankExample: function (dropEvent, ruleElementsGroup) {
            dropEvent.preventDefault();

            var newExampleText = document.createElement("input");
            newExampleText.type = "text";
            newExampleText.className = "exampleWording";
            newExampleText.name = "Rules[????].Examples[????].Name";
            ruleElementsGroup.appendChild(newExampleText);
        },

        MakeRuleElementName: function (ruleIndex, backingPropertyName) {
            return "Rules[" + ruleIndex + "]." + backingPropertyName;
        },

        RemoveRuleDomElements: function (ruleElementsGroup) {
            ruleElementsGroup.parentNode.removeChild(ruleElementsGroup);
        },

        Single: function (arrayLike, predicate) {
            var matchingElement = null;
            var matchingElementFound = false;
            for (var i = 0; i !== arrayLike.length; ++i) {
                if (predicate(arrayLike[i])) {
                    if (matchingElementFound) {
                        throw "Program Logic Exception: non-unique element found.";
                    }

                    matchingElementFound = true;
                    matchingElement = arrayLike[i];
                }
            }

            if (!matchingElementFound) {
                throw "Program Logic Exception: single element matching the criteria was expected to be presetn in collection, but none was found.";
            }

            return matchingElement;
        }
    };
}

var AllRulesCollection = newRuleCollection();

function newDragDropProcessor() {
    var draggingRuleType = "95D959BF-8F42-4F22-BBDA-2CC38BFA9548";
    var draggingExampleType = "A24BC9D5-4DB9-42BF-86DE-E31C0C585044";

    return {
        StartDraggingBlankExample: function(dragEvent) {
            dragEvent.dataTransfer.setData("text", "");
        }
    };
}



function StartDraggingBlankExample(dragEvent) {
    
}